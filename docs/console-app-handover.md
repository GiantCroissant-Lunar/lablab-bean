**⚠️ NOTE: This document is outdated. See latest handover:**

- **Latest**: `docs/_inbox/2025-10-24-release-console-artifact-verification-handover.md`
- **Status**: Artifact verification integrated, Boss/Progression/Quest re-enabled (11 plugins verified)

---

**Purpose**

- Capture current status, how to build/run from versioned artifacts, and the next actions to fix Diagnostic plugins and finalize console app run.

**Current Status**

- Console app builds and runs. TUI code updated for `Terminal.Gui` v2 API.
- Windows app builds successfully.
- NUKE publishes versioned artifacts with a one‑liner and can generate reports from the artifact binary.
- Plugins CLI added to the console app: `plugins list` for discovery/debug.
- Diagnostic.* plugins are excluded from publish due to API mismatches and will be fixed next.

**Key Changes (already merged to `main`)**

- `dotnet/framework/LablabBean.Game.Core/LablabBean.Game.Core.csproj:9` adds reference to `LablabBean.Contracts.UI`.
- `dotnet/framework/LablabBean.Contracts.UI/LablabBean.Contracts.UI.csproj:18` adds `TheSadRogue.Primitives` package.
- `Terminal.Gui` API updates in:
  - `dotnet/console-app/LablabBean.Game.TerminalUI/Views/ActivityLogView.cs`
  - `dotnet/console-app/LablabBean.Game.TerminalUI/Views/DialogueView.cs`
  - `dotnet/console-app/LablabBean.Game.TerminalUI/Views/QuestLogView.cs`
- Plugins CLI:
  - `dotnet/console-app/LablabBean.Console/Commands/PluginsCommand.cs:1`
  - `dotnet/console-app/LablabBean.Console/Program.cs` wires the `plugins` root command.
- NUKE publish + reports improvements:
  - `build/nuke/Build.cs` packs console + plugins to versioned artifacts and adds `ReleaseConsole` target.
  - `dotnet/plugins/Directory.Build.targets` avoids `plugin.json` publish conflicts.

**Terminal.Gui Version**

- Centrally pinned to `2.0.0-pre.71`:
  - `dotnet/console-app/Directory.Packages.props:10`
- Verified in `project.assets.json` of the console project.

**Build & Publish (Recommended)**

- One‑liner release for console (build, publish, generate reports):
  - `dotnet run --project build/nuke/Build.csproj --target ReleaseConsole -configuration Release`
- Versioned artifact layout (example):
  - `build/_artifacts/<version>/publish/console/`
  - `build/_artifacts/<version>/publish/windows/`
  - `build/_artifacts/<version>/test-reports/`

**Run From Versioned Artifact**

- Change working directory to the console publish folder to ensure relative plugin paths resolve:
  - `cd build/_artifacts/<version>/publish/console`
  - `.\n+LablabBean.Console.exe report --help`
  - `.
LablabBean.Console.exe plugins list`
- Note: Relative plugin paths are resolved against the current working directory. Running the EXE from another location may yield “No plugins discovered”.

**Task Commands**

- Build (console only):
  - `task build:console`
- Publish both apps (Debug) to versioned artifacts:
  - `task publish`
- Full release (includes website copy):
  - `task release`

**Reports**

- Generated by `ReleaseConsole` or:
  - `dotnet run --project build/nuke/Build.csproj --target GenerateReports -configuration Release`
- Reads build/test results and writes HTML/CSV under `build/_artifacts/<version>/test-reports/`.

**Next Session: Diagnostic Plugins Fix Plan**

- Goal: Re‑enable Diagnostic.* plugins and include them in published artifacts; ensure console app loads them and diagnostic data flows to reports.
- Known issues observed previously (to confirm and fix):
  - `LablabBean.Plugins.Diagnostic.Console`
    - Uses outdated models: `PerformanceMetrics.HandleCount`, `MemoryInfo.WorkingSetBytes/PrivateMemoryBytes/ManagedMemoryBytes/Gen*Collections`, `DeviceInfo.Architecture`, and `DiagnosticData.Provider` accessors were referenced but not present. Adjust to current contracts.
  - `LablabBean.Plugins.Diagnostic.Firebase/OpenTelemetry/Sentry`
    - `ProviderHealthResult` no longer has `ResponseTime`.
    - Health details now likely use `List<LablabBean.Contracts.Diagnostic.HealthCheckDetail>` instead of dictionaries.
    - `IPluginContext.Services` not found: reconcile with current `IPluginContext` surface; use `context.Registry` and injected services as intended.
- Approach:
  1) Build Diagnostic.* projects independently to reproduce compile errors.
  2) Align plugins to current contracts in `dotnet/framework/LablabBean.Plugins.Contracts` and diagnostics models.
  3) Add or adapt mappers for any model shape changes.
  4) Re‑enable Diagnostic.* in NUKE plugin packaging (remove exclusion filters in `build/nuke/Build.cs`).
  5) Validate runtime loading via `plugins list` and smoke test basic health output.

**Open Items / Decisions**

- If we want plugins discovered regardless of working directory, update plugin loader to resolve relative paths against the hosting assembly directory (in addition to `Environment.CurrentDirectory`).
- Optionally add a Task alias for the ReleaseConsole workflow (e.g., `task release:console`) that maps to NUKE `ReleaseConsole`.

**Quick Reference**

- Build (fast): `task build:console`
- Publish (Debug): `task publish`
- Release (Console, Reports): `dotnet run --project build/nuke/Build.csproj --target ReleaseConsole -configuration Release`
- Run from artifact:
  - `cd build/_artifacts/<version>/publish/console`
  - `.
LablabBean.Console.exe plugins list`
  - `.
LablabBean.Console.exe report --help`
