#!/usr/bin/env bash
# Pre-commit hook to prevent Windows 'nul' file from being committed
#
# This file is created by Windows command redirections like:
#   dir /s /b *.json 2>nul
# Instead of redirecting to the null device, it creates a file named 'nul'
#
# This hook:
# 1. Prevents the 'nul' file from being committed
# 2. Automatically removes it if found
# 3. Warns the developer about proper command usage

# Check if 'nul' file is being committed
if git diff --cached --name-only | grep -q '^nul$'; then
    echo "‚ùå ERROR: Attempting to commit Windows 'nul' file"
    echo ""
    echo "The file 'nul' is created by Windows command redirections like:"
    echo "  dir /s /b *.json 2>nul"
    echo ""
    echo "üîß Solutions:"
    echo "  1. Use PowerShell instead of cmd: Get-ChildItem -Recurse -Filter *.json"
    echo "  2. Use bash/Git Bash: find . -name '*.json' 2>/dev/null"
    echo "  3. Don't redirect stderr: dir /s /b *.json"
    echo ""
    echo "üßπ Auto-cleanup: Removing 'nul' file and unstaging..."

    # Remove the nul file
    rm -f nul

    # Unstage it
    git reset HEAD nul 2>/dev/null

    echo "‚úÖ Fixed! Please commit again."
    exit 1
fi

# Check if nul file exists in working directory (even if not staged)
if [ -f "nul" ]; then
    echo "‚ö†Ô∏è  WARNING: Found 'nul' file in working directory"
    echo "üßπ Auto-cleanup: Removing it..."
    rm -f nul
    echo "‚úÖ Cleaned up."
fi

exit 0
