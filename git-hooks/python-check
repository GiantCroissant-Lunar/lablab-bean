#!/bin/bash
# Python code quality check
# Uses Ruff (modern replacement for black, flake8, isort, and more)

set -e

echo "Running Python code quality checks..."

# Get staged Python files
PYTHON_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.py$' || true)

if [ -z "$PYTHON_FILES" ]; then
    echo "No Python files to check"
    exit 0
fi

echo "Checking Python files: $PYTHON_FILES"

# Check if ruff is installed
if ! command -v ruff &> /dev/null; then
    echo "Warning: ruff not found"
    echo "Install with: pip install ruff"
    echo "  or: uv tool install ruff"
    echo "  or: pipx install ruff"
    echo ""
    echo "Ruff is a fast Python linter and formatter that replaces:"
    echo "  - black (formatter)"
    echo "  - flake8 (linter)"
    echo "  - isort (import sorter)"
    echo "  - and 50+ other tools"
    echo ""
    echo "Skipping Python checks..."
    exit 0
fi

# Run ruff linter with auto-fix
echo "Running ruff check (linter + import sorter)..."
ruff check --fix $PYTHON_FILES || true

# Run ruff formatter (replaces black)
echo "Running ruff format (formatter)..."
ruff format $PYTHON_FILES

# Optional: Run mypy for type checking if installed
if command -v mypy &> /dev/null; then
    echo "Running mypy (type checker)..."
    mypy --ignore-missing-imports --no-strict-optional $PYTHON_FILES || true
fi

# Re-add files that were formatted
git add $PYTHON_FILES

echo "âœ“ Python code quality checks passed"
